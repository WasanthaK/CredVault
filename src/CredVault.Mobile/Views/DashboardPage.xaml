<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:CredVault.Mobile.ViewModels"
             x:Class="CredVault.Mobile.Views.DashboardPage"
             x:DataType="vm:DashboardViewModel"
             Title=""
             NavigationPage.HasNavigationBar="False"
             BackgroundColor="{AppThemeBinding Light=#F5F7F8, Dark=#0F1823}">

    <Grid RowDefinitions="Auto,Auto,*">
        <!-- Top App Bar -->
        <Grid Grid.Row="0" Padding="16,16,16,8" ColumnDefinitions="Auto,*,Auto,Auto" ColumnSpacing="12">
            <!-- User Avatar & Greeting -->
            <Border Grid.Column="0"
                   StrokeThickness="0"
                   WidthRequest="40"
                   HeightRequest="40"
                   BackgroundColor="{StaticResource Primary}">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="20"/>
                </Border.StrokeShape>
                <Label Text="ðŸ‘¤"
                      FontSize="20"
                      HorizontalOptions="Center"
                      VerticalOptions="Center"/>
            </Border>

            <Label Grid.Column="1"
                  Text="{Binding GreetingText}"
                  FontSize="20"
                  FontAttributes="Bold"
                  VerticalOptions="Center"
                  TextColor="{AppThemeBinding Light=#212529, Dark=White}"/>

            <!-- Backup Button -->
            <Border Grid.Column="2"
                   StrokeThickness="0"
                   WidthRequest="40"
                   HeightRequest="40"
                   BackgroundColor="Transparent">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="20"/>
                </Border.StrokeShape>
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding NavigateToBackupCommand}"/>
                </Border.GestureRecognizers>
                <Label Text="ðŸ’¾"
                      FontSize="20"
                      HorizontalOptions="Center"
                      VerticalOptions="Center"/>
            </Border>

            <!-- Settings Button -->
            <Border Grid.Column="3"
                   StrokeThickness="0"
                   WidthRequest="40"
                   HeightRequest="40"
                   BackgroundColor="Transparent">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="20"/>
                </Border.StrokeShape>
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding NavigateToSettingsCommand}"/>
                </Border.GestureRecognizers>
                <Label Text="âš™ï¸"
                      FontSize="20"
                      HorizontalOptions="Center"
                      VerticalOptions="Center"/>
            </Border>
        </Grid>

        <!-- Credential Carousel -->
        <CollectionView Grid.Row="1"
                       ItemsSource="{Binding Credentials}"
                       SelectionMode="None"
                       HeightRequest="160"
                       Margin="0,16,0,0">
            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Horizontal" ItemSpacing="12"/>
            </CollectionView.ItemsLayout>
            
            <CollectionView.Header>
                <BoxView WidthRequest="16" BackgroundColor="Transparent"/>
            </CollectionView.Header>
            
            <CollectionView.Footer>
                <BoxView WidthRequest="16" BackgroundColor="Transparent"/>
            </CollectionView.Footer>

            <CollectionView.EmptyView>
                <StackLayout Padding="40" HorizontalOptions="Center">
                    <Label Text="ðŸ“‹"
                          FontSize="48"
                          HorizontalOptions="Center"/>
                    <Label Text="No credentials yet"
                          FontSize="16"
                          FontAttributes="Bold"
                          HorizontalOptions="Center"
                          Margin="0,12,0,4"
                          TextColor="{AppThemeBinding Light=#212529, Dark=White}"/>
                    <Label Text="Tap + to add your first credential"
                          FontSize="14"
                          TextColor="{AppThemeBinding Light=#6C757D, Dark=#8DA9CE}"
                          HorizontalOptions="Center"/>
                </StackLayout>
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="vm:CredentialCardInfo">
                    <Border StrokeThickness="0"
                           WidthRequest="256"
                           BackgroundColor="{AppThemeBinding Light=White, Dark=#1A2635}"
                           Padding="16">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="12"/>
                        </Border.StrokeShape>
                        <Border.Shadow>
                            <Shadow Brush="Black" Opacity="0.1" Radius="8" Offset="0,2"/>
                        </Border.Shadow>
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:DashboardViewModel}}, Path=ViewCredentialCommand}"
                                                 CommandParameter="{Binding .}"/>
                        </Border.GestureRecognizers>

                        <Grid RowDefinitions="Auto,*" RowSpacing="16">
                            <!-- Header -->
                            <Grid Grid.Row="0" ColumnDefinitions="Auto,*,Auto">
                                <!-- Issuer Logo -->
                                <Border Grid.Column="0"
                                       StrokeThickness="0"
                                       WidthRequest="40"
                                       HeightRequest="40"
                                       BackgroundColor="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray700}}">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="8"/>
                                    </Border.StrokeShape>
                                    <Label Text="{Binding Icon}"
                                          FontSize="20"
                                          HorizontalOptions="Center"
                                          VerticalOptions="Center"/>
                                </Border>

                                <!-- Status Indicator -->
                                <BoxView Grid.Column="2"
                                        WidthRequest="12"
                                        HeightRequest="12"
                                        CornerRadius="6"
                                        Color="{Binding StatusColor}"
                                        VerticalOptions="Start"
                                        Margin="0,4,0,0"/>
                            </Grid>

                            <!-- Credential Info -->
                            <VerticalStackLayout Grid.Row="1" Spacing="4">
                                <Label Text="{Binding Name}"
                                      FontSize="16"
                                      FontAttributes="Bold"
                                      TextColor="{AppThemeBinding Light=#212529, Dark=White}"/>
                                <Label Text="{Binding ExpiryInfo}"
                                      FontSize="13"
                                      TextColor="{AppThemeBinding Light=#6C757D, Dark=#8DA9CE}"/>
                            </VerticalStackLayout>
                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- Main Content -->
        <ScrollView Grid.Row="2" Margin="16,24,16,100">
            <VerticalStackLayout Spacing="20">
                <!-- Quick Actions -->
                <VerticalStackLayout Spacing="12">
                    <Label Text="Quick Actions"
                          FontSize="18"
                          FontAttributes="Bold"
                          TextColor="{AppThemeBinding Light=#212529, Dark=White}"/>

                    <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" ColumnSpacing="12" RowSpacing="12">
                        <!-- Add Credential -->
                        <Border Grid.Column="0" Grid.Row="0"
                               StrokeThickness="0"
                               Padding="16"
                               BackgroundColor="{AppThemeBinding Light=White, Dark=#1A2635}">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="12"/>
                            </Border.StrokeShape>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding AddCredentialCommand}"/>
                            </Border.GestureRecognizers>
                            <VerticalStackLayout Spacing="8" HorizontalOptions="Center">
                                <Label Text="+"
                                      FontSize="32"
                                      TextColor="{StaticResource Primary}"
                                      HorizontalOptions="Center"/>
                                <Label Text="Add"
                                      FontSize="14"
                                      FontAttributes="Bold"
                                      HorizontalOptions="Center"
                                      TextColor="{AppThemeBinding Light=#212529, Dark=White}"/>
                            </VerticalStackLayout>
                        </Border>

                        <!-- Share Credential -->
                        <Border Grid.Column="1" Grid.Row="0"
                               StrokeThickness="0"
                               Padding="16"
                               BackgroundColor="{AppThemeBinding Light=White, Dark=#1A2635}">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="12"/>
                            </Border.StrokeShape>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding ShareCredentialCommand}"/>
                            </Border.GestureRecognizers>
                            <VerticalStackLayout Spacing="8" HorizontalOptions="Center">
                                <Label Text="ðŸ“¤"
                                      FontSize="32"
                                      HorizontalOptions="Center"/>
                                <Label Text="Share"
                                      FontSize="14"
                                      FontAttributes="Bold"
                                      HorizontalOptions="Center"
                                      TextColor="{AppThemeBinding Light=#212529, Dark=White}"/>
                            </VerticalStackLayout>
                        </Border>

                        <!-- Scan QR -->
                        <Border Grid.Column="0" Grid.Row="1"
                               StrokeThickness="0"
                               Padding="16"
                               BackgroundColor="{AppThemeBinding Light=White, Dark=#1A2635}">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="12"/>
                            </Border.StrokeShape>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding ScanQRCommand}"/>
                            </Border.GestureRecognizers>
                            <VerticalStackLayout Spacing="8" HorizontalOptions="Center">
                                <Label Text="ðŸ“·"
                                      FontSize="32"
                                      HorizontalOptions="Center"/>
                                <Label Text="Scan"
                                      FontSize="14"
                                      FontAttributes="Bold"
                                      HorizontalOptions="Center"
                                      TextColor="{AppThemeBinding Light=#212529, Dark=White}"/>
                            </VerticalStackLayout>
                        </Border>

                        <!-- Activity -->
                        <Border Grid.Column="1" Grid.Row="1"
                               StrokeThickness="0"
                               Padding="16"
                               BackgroundColor="{AppThemeBinding Light=White, Dark=#1A2635}">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="12"/>
                            </Border.StrokeShape>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding ViewActivityCommand}"/>
                            </Border.GestureRecognizers>
                            <VerticalStackLayout Spacing="8" HorizontalOptions="Center">
                                <Label Text="ðŸ“Š"
                                      FontSize="32"
                                      HorizontalOptions="Center"/>
                                <Label Text="Activity"
                                      FontSize="14"
                                      FontAttributes="Bold"
                                      HorizontalOptions="Center"
                                      TextColor="{AppThemeBinding Light=#212529, Dark=White}"/>
                            </VerticalStackLayout>
                        </Border>
                    </Grid>
                </VerticalStackLayout>

                <!-- Recent Activity -->
                <VerticalStackLayout Spacing="12"
                                    IsVisible="{Binding HasRecentActivity}">
                    <Label Text="Recent Activity"
                          FontSize="18"
                          FontAttributes="Bold"
                          TextColor="{AppThemeBinding Light=#212529, Dark=White}"/>

                    <CollectionView ItemsSource="{Binding RecentActivities}"
                                   SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="vm:ActivityInfo">
                                <Border StrokeThickness="0"
                                       Margin="0,0,0,8"
                                       Padding="12"
                                       BackgroundColor="{AppThemeBinding Light=White, Dark=#1A2635}">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="12"/>
                                    </Border.StrokeShape>
                                    <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                                        <Label Grid.Column="0"
                                              Text="{Binding Icon}"
                                              FontSize="24"
                                              VerticalOptions="Center"/>
                                        <VerticalStackLayout Grid.Column="1" Spacing="4" VerticalOptions="Center">
                                            <Label Text="{Binding Description}"
                                                  FontSize="14"
                                                  TextColor="{AppThemeBinding Light=#212529, Dark=White}"/>
                                            <Label Text="{Binding TimeAgo}"
                                                  FontSize="12"
                                                  TextColor="{AppThemeBinding Light=#6C757D, Dark=#8DA9CE}"/>
                                        </VerticalStackLayout>
                                        <Label Grid.Column="2"
                                              Text="â€º"
                                              FontSize="20"
                                              TextColor="{AppThemeBinding Light=#6C757D, Dark=#8DA9CE}"
                                              VerticalOptions="Center"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>
