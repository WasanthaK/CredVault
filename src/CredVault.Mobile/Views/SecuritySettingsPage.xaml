<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:CredVault.Mobile.ViewModels"
             x:Class="CredVault.Mobile.Views.SecuritySettingsPage"
             x:DataType="vm:SecuritySettingsViewModel"
             Title=""
             NavigationPage.HasNavigationBar="False"
             BackgroundColor="{AppThemeBinding Light=#F5F7F8, Dark=#0F1823}">

    <Grid RowDefinitions="Auto,*">
        <!-- Top App Bar -->
        <Grid Grid.Row="0" BackgroundColor="{StaticResource Primary}" Padding="16,16,16,8" ColumnDefinitions="Auto,*,Auto">
            <Label Grid.Column="0"
                  Text="â€¹"
                  FontSize="28"
                  TextColor="White"
                  VerticalOptions="Center">
                <Label.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding GoBackCommand}"/>
                </Label.GestureRecognizers>
            </Label>

            <Label Grid.Column="1"
                  Text="Security"
                  FontSize="18"
                  FontAttributes="Bold"
                  TextColor="White"
                  HorizontalOptions="Center"
                  VerticalOptions="Center"/>

            <BoxView Grid.Column="2" WidthRequest="28" BackgroundColor="Transparent"/>
        </Grid>

        <!-- Content -->
        <ScrollView Grid.Row="1" Padding="16">
            <VerticalStackLayout Spacing="16">
                <!-- Settings Card -->
                <Border StrokeThickness="0"
                       BackgroundColor="{AppThemeBinding Light=White, Dark=#1C1C1E}">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12"/>
                    </Border.StrokeShape>
                    <Border.Shadow>
                        <Shadow Brush="Black" Opacity="0.08" Radius="8" Offset="0,2"/>
                    </Border.Shadow>

                    <VerticalStackLayout>
                        <!-- Enable Biometrics -->
                        <Grid Padding="16" ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                            <!-- Icon -->
                            <Border Grid.Column="0"
                                   StrokeThickness="0"
                                   WidthRequest="48"
                                   HeightRequest="48"
                                   BackgroundColor="{StaticResource Primary}"
                                   Opacity="0.2">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="12"/>
                                </Border.StrokeShape>
                                <Label Text="ðŸ”"
                                      FontSize="24"
                                      HorizontalOptions="Center"
                                      VerticalOptions="Center"/>
                            </Border>

                            <!-- Text -->
                            <VerticalStackLayout Grid.Column="1" Spacing="4" VerticalOptions="Center">
                                <Label Text="Enable Biometrics"
                                      FontSize="16"
                                      FontAttributes="Bold"
                                      TextColor="{AppThemeBinding Light=#1C1C1E, Dark=White}"/>
                                <Label Text="Use your fingerprint or face to unlock the app and authorize actions."
                                      FontSize="14"
                                      LineBreakMode="WordWrap"
                                      TextColor="{AppThemeBinding Light=#6E6E73, Dark=#8DA9CE}"/>
                            </VerticalStackLayout>

                            <!-- Toggle Switch -->
                            <Switch Grid.Column="2"
                                   IsToggled="{Binding IsBiometricsEnabled}"
                                   OnColor="{StaticResource Primary}"
                                   VerticalOptions="Center"/>
                        </Grid>

                        <!-- Divider -->
                        <BoxView HeightRequest="1"
                                BackgroundColor="{AppThemeBinding Light=#E5E5EA, Dark=#38383A}"
                                Margin="16,0"/>

                        <!-- Require PIN for Sharing -->
                        <Grid Padding="16" ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                            <!-- Icon -->
                            <Border Grid.Column="0"
                                   StrokeThickness="0"
                                   WidthRequest="48"
                                   HeightRequest="48"
                                   BackgroundColor="{StaticResource Primary}"
                                   Opacity="0.2">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="12"/>
                                </Border.StrokeShape>
                                <Label Text="ðŸ›¡ï¸"
                                      FontSize="24"
                                      HorizontalOptions="Center"
                                      VerticalOptions="Center"/>
                            </Border>

                            <!-- Text -->
                            <VerticalStackLayout Grid.Column="1" Spacing="4" VerticalOptions="Center">
                                <Label Text="Require PIN for Sharing"
                                      FontSize="16"
                                      FontAttributes="Bold"
                                      TextColor="{AppThemeBinding Light=#1C1C1E, Dark=White}"/>
                                <Label Text="Always ask for your PIN or biometrics before sharing a credential."
                                      FontSize="14"
                                      LineBreakMode="WordWrap"
                                      TextColor="{AppThemeBinding Light=#6E6E73, Dark=#8DA9CE}"/>
                            </VerticalStackLayout>

                            <!-- Toggle Switch -->
                            <Switch Grid.Column="2"
                                   IsToggled="{Binding RequirePinForSharing}"
                                   OnColor="{StaticResource Primary}"
                                   VerticalOptions="Center"/>
                        </Grid>
                    </VerticalStackLayout>
                </Border>

                <!-- Success Alert (conditional) -->
                <Border StrokeThickness="0"
                       BackgroundColor="{AppThemeBinding Light=#D1F2EB, Dark=#0F4C3A}"
                       Padding="16"
                       IsVisible="{Binding ShowSuccessMessage}">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12"/>
                    </Border.StrokeShape>
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
                        <Label Grid.Column="0"
                              Text="âœ“"
                              FontSize="24"
                              TextColor="{AppThemeBinding Light=#0F7C5F, Dark=#2ECC71}"
                              VerticalOptions="Center"/>
                        <Label Grid.Column="1"
                              Text="Settings updated successfully."
                              FontSize="14"
                              FontAttributes="Bold"
                              TextColor="{AppThemeBinding Light=#0F7C5F, Dark=#2ECC71}"
                              VerticalOptions="Center"/>
                    </Grid>
                </Border>

                <!-- Additional Security Options -->
                <Border StrokeThickness="0"
                       BackgroundColor="{AppThemeBinding Light=White, Dark=#1C1C1E}">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12"/>
                    </Border.StrokeShape>
                    <Border.Shadow>
                        <Shadow Brush="Black" Opacity="0.08" Radius="8" Offset="0,2"/>
                    </Border.Shadow>

                    <VerticalStackLayout>
                        <!-- Change PIN -->
                        <Grid Padding="16" ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding ChangePinCommand}"/>
                            </Border.GestureRecognizers>

                            <Label Grid.Column="0"
                                  Text="ðŸ”‘"
                                  FontSize="24"
                                  VerticalOptions="Center"/>

                            <Label Grid.Column="1"
                                  Text="Change PIN"
                                  FontSize="16"
                                  TextColor="{AppThemeBinding Light=#1C1C1E, Dark=White}"
                                  VerticalOptions="Center"/>

                            <Label Grid.Column="2"
                                  Text="â€º"
                                  FontSize="24"
                                  TextColor="{AppThemeBinding Light=#6E6E73, Dark=#8DA9CE}"
                                  VerticalOptions="Center"/>
                        </Grid>

                        <!-- Divider -->
                        <BoxView HeightRequest="1"
                                BackgroundColor="{AppThemeBinding Light=#E5E5EA, Dark=#38383A}"
                                Margin="16,0"/>

                        <!-- Auto-Lock Timeout -->
                        <Grid Padding="16" ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding SetAutoLockCommand}"/>
                            </Border.GestureRecognizers>

                            <Label Grid.Column="0"
                                  Text="â±ï¸"
                                  FontSize="24"
                                  VerticalOptions="Center"/>

                            <VerticalStackLayout Grid.Column="1" Spacing="2" VerticalOptions="Center">
                                <Label Text="Auto-Lock Timeout"
                                      FontSize="16"
                                      TextColor="{AppThemeBinding Light=#1C1C1E, Dark=White}"/>
                                <Label Text="{Binding AutoLockTimeoutText}"
                                      FontSize="14"
                                      TextColor="{AppThemeBinding Light=#6E6E73, Dark=#8DA9CE}"/>
                            </VerticalStackLayout>

                            <Label Grid.Column="2"
                                  Text="â€º"
                                  FontSize="24"
                                  TextColor="{AppThemeBinding Light=#6E6E73, Dark=#8DA9CE}"
                                  VerticalOptions="Center"/>
                        </Grid>
                    </VerticalStackLayout>
                </Border>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>
